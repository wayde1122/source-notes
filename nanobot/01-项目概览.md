# nanobot 项目概览

## 基本信息

| 属性       | 内容                                   |
| ---------- | -------------------------------------- |
| 名称       | nanobot-ai                             |
| 版本       | 0.1.3.post7                            |
| 定位       | 轻量级个人 AI 助手框架                 |
| 语言       | Python 3.11+（附带 TypeScript Bridge） |
| 核心代码   | 约 4000 行                             |
| 协议       | MIT                                    |
| 仓库       | https://github.com/HKUDS/nanobot      |

## 项目解决什么问题

nanobot 提供一个 **可自托管** 的轻量 AI 助手框架，让个人用户能够：

1. 通过多个聊天平台（Telegram / WhatsApp / Discord / 飞书 / 钉钉 / Slack / QQ / Email / Mochat）与 AI 交互
2. 让 AI 拥有工具能力（读写文件、执行命令、搜索网页、发送消息）
3. 支持多个 LLM 提供商（Anthropic / OpenAI / DeepSeek / Gemini / 通义千问 / Moonshot 等 12+）
4. 自动管理长期记忆和会话历史
5. 支持定时任务和后台子 Agent

## 技术栈

| 层次        | 技术                                                                        |
| ----------- | --------------------------------------------------------------------------- |
| CLI         | Typer + Rich + prompt_toolkit                                               |
| LLM 调用    | LiteLLM（统一多提供商）                                                     |
| 配置管理    | Pydantic + pydantic-settings                                                |
| HTTP 客户端 | httpx                                                                       |
| 网页提取    | readability-lxml                                                            |
| 日志        | Loguru                                                                      |
| 异步        | asyncio（全异步架构）                                                       |
| 存储        | 纯文件（JSON / JSONL / Markdown）                                           |
| 渠道 SDK    | python-telegram-bot / lark-oapi / slack-sdk / qq-botpy / dingtalk-stream 等 |

## 目录结构

```
nanobot/
├── __init__.py            # 包元数据（版本号、Logo）
├── __main__.py            # python -m nanobot 入口
├── cli/
│   └── commands.py        # CLI 命令定义（Typer）
├── config/
│   ├── schema.py          # Pydantic 配置模型
│   └── loader.py          # 配置加载/保存/迁移
├── bus/
│   ├── events.py          # InboundMessage / OutboundMessage 事件
│   └── queue.py           # 异步消息总线
├── agent/
│   ├── loop.py            # 核心 Agent 处理循环
│   ├── context.py         # 提示词/上下文构建器
│   ├── memory.py          # 双层记忆系统
│   ├── skills.py          # 技能加载器
│   ├── subagent.py        # 子 Agent 管理
│   └── tools/
│       ├── base.py        # 工具抽象基类
│       ├── registry.py    # 工具注册表
│       ├── filesystem.py  # 文件操作（read/write/edit/list）
│       ├── shell.py       # Shell 执行（带安全防护）
│       ├── web.py         # 网页搜索 + 抓取
│       ├── message.py     # 消息发送
│       ├── spawn.py       # 子 Agent 派生
│       └── cron.py        # 定时任务
├── channels/
│   ├── base.py            # 渠道抽象基类
│   ├── manager.py         # 渠道管理器
│   └── telegram.py / discord.py / whatsapp.py / slack.py
│     / feishu.py / dingtalk.py / email.py / mochat.py / qq.py
├── providers/
│   ├── base.py            # LLM 提供商接口
│   ├── registry.py        # 提供商元数据注册表
│   ├── litellm_provider.py # LiteLLM 实现
│   └── transcription.py   # 语音转写（Whisper）
├── session/
│   └── manager.py         # 会话管理（JSONL 存储）
├── cron/
│   ├── types.py           # 定时任务数据结构
│   └── service.py         # 定时任务服务
├── heartbeat/
│   └── service.py         # 心跳唤醒服务
├── utils/
│   └── helpers.py         # 工具函数
└── skills/                # 内置技能（Markdown）
    ├── github/ / weather/ / summarize/ / tmux/
    ├── memory/ / cron/ / skill-creator/
    └── README.md
```

## 存储结构（纯文件，无数据库）

```
~/.nanobot/
├── config.json                          # 全局配置
├── sessions/
│   └── {channel}_{chat_id}.jsonl        # 会话记录
├── workspace/
│   ├── AGENTS.md / SOUL.md / USER.md    # 引导文件
│   ├── memory/
│   │   ├── MEMORY.md                    # 长期记忆
│   │   └── HISTORY.md                   # 历史日志
│   └── skills/                          # 用户自定义技能
├── cron/
│   └── jobs.json                        # 定时任务
└── media/                               # 渠道下载的媒体文件
```
